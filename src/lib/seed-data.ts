'use client';
import type { Equipment, VSD } from '@/lib/types';
import { format } from 'date-fns';
import {
  CollectionReference,
  doc,
  writeBatch,
  collection,
} from 'firebase/firestore';
import type { Firestore } from 'firebase/firestore';
import { toast } from '@/hooks/use-toast';

const today = format(new Date(), 'yyyy-MM-dd');
const nextMaintenance = format(
  new Date(new Date().setMonth(new Date().getMonth() + 3)),
  'yyyy-MM-dd'
);

const equipmentData: { equipment: Equipment; vsd: VSD }[] = [
  {
    equipment: {
      id: 'MPA-PUMP-1',
      name: 'Main Pump No. 1',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-1',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-1',
      equipmentId: 'MPA-PUMP-1',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-PUMP-2',
      name: 'Main Pump No. 2',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-2',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-2',
      equipmentId: 'MPA-PUMP-2',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-HYD-MOTOR-1',
      name: 'Hydraulic Motor 1 Canti-levered',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-3',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-3',
      equipmentId: 'MPA-HYD-MOTOR-1',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-HYD-MOTOR-2',
      name: 'Hydraulic Motor 2 Canti-levered',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-4',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-4',
      equipmentId: 'MPA-HYD-MOTOR-2',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-SWING-L',
      name: 'Swing Winch Left',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-5',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-5',
      equipmentId: 'MPA-SWING-L',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-SWING-R',
      name: 'Swing Winch Right',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-6',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-6',
      equipmentId: 'MPA-SWING-R',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-SPOOL-CARRIAGE',
      name: 'Spool Carriage Winch',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-7',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-7',
      equipmentId: 'MPA-SPOOL-CARRIAGE',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-TAILS-DISPOSAL',
      name: 'Tails Disposal Pump',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-8',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-8',
      equipmentId: 'MPA-TAILS-DISPOSAL',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-TAILS-TRANSFER',
      name: 'Tails Transfer Pump',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-9',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-9',
      equipmentId: 'MPA-TAILS-TRANSFER',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-SLURRY-TRANSFER',
      name: 'Slurry Transfer Pump',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-10',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-10',
      equipmentId: 'MPA-SLURRY-TRANSFER',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-SCAVENGER-MEGA',
      name: 'Scavenger Mega Pump',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-11',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-11',
      equipmentId: 'MPA-SCAVENGER-MEGA',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-SCAVENGER-THUNDER',
      name: 'Scavenger Thunder Pump',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-12',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-12',
      equipmentId: 'MPA-SCAVENGER-THUNDER',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-MAGNETITE',
      name: 'Magnetite Feed Pump',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-13',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-13',
      equipmentId: 'MPA-MAGNETITE',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-ROAG',
      name: 'Roag Cons Pump',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-14',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-14',
      equipmentId: 'MPA-ROAG',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-FINAL-CONS-1',
      name: 'Final Cons Pump 1',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-15',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-15',
      equipmentId: 'MPA-FINAL-CONS-1',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-FINAL-CONS-2',
      name: 'Final Cons Pump 2',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-16',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-16',
      equipmentId: 'MPA-FINAL-CONS-2',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-FLOOR-SUMP',
      name: 'Floor Sump Pump',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-17',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-17',
      equipmentId: 'MPA-FLOOR-SUMP',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-SCAVENGER-FEED',
      name: 'Scavenger Feed Pump',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-18',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-18',
      equipmentId: 'MPA-SCAVENGER-FEED',
      model: 'ACS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-1ST-TAILS',
      name: '1st Stage Tails Pump',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-19',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-19',
      equipmentId: 'MPA-1ST-TAILS',
      model: 'DCS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  {
    equipment: {
      id: 'MPA-2ND-TAILS',
      name: '2nd Stage Tails Pump',
      type: 'Pump',
      plant: 'Mining',
      division: 'Boosters',
      location: 'MPA',
      vsdId: 'MPA-VSD-20',
      lastMaintenance: today,
      nextMaintenance: nextMaintenance,
      uptime: 100,
      powerConsumption: 0,
      pumpHead: 0,
      flowRate: 0,
      totalDowntimeHours: 0,
    } as Equipment,
    vsd: {
      id: 'MPA-VSD-20',
      equipmentId: 'MPA-2ND-TAILS',
      model: 'DCS800',
      serialNumber: 'TBD',
      installationDate: today,
      status: 'active',
    },
  },
  // ... and so on for all the other equipment
];

export async function seedDatabase(db: Firestore) {
  const equipmentCol = collection(db, 'equipment') as CollectionReference<Equipment>;
  const vsdCol = collection(db, 'vsds') as CollectionReference<VSD>;

  try {
    const batch = writeBatch(db);
    let count = 0;

    for (const { equipment, vsd } of equipmentData) {
      // Set equipment data
      batch.set(doc(equipmentCol, equipment.id), equipment);

      // Set VSD data
      batch.set(doc(vsdCol, vsd.id), vsd);

      count++;
      // Firestore allows a maximum of 500 operations per batch
      if (count % 499 === 0) {
        await batch.commit();
        // batch = writeBatch(db); // Re-initialize for next set of operations
      }
    }

    // Commit any remaining operations
    await batch.commit();
    toast({
      title: 'Database Seeded!',
      description: `${count} equipment and VSD records have been added.`,
    });
  } catch (error) {
    console.error('Error seeding database:', error);
    toast({
      variant: 'destructive',
      title: 'Database Seeding Failed',
      description:
        'An error occurred while seeding the database. Check the console for details.',
    });
  }
}
