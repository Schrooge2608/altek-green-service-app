
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    function isAuthenticated() {
      return request.auth != null;
    }

    // VSDs Collection
    match /vsds {
      allow list: if isAuthenticated();
    }
    match /vsds/{vsdId} {
      allow read, write: if isAuthenticated();
    }

    // Equipment Collection
    match /equipment {
      allow list: if isAuthenticated();
    }
    match /equipment/{equipmentId} {
      allow read, write: if isAuthenticated();
    }
    match /equipment/{equipmentId}/performance_records/{recordId} {
      allow read, write: if isAuthenticated();
    }

    // Tasks Collection
    match /tasks {
      allow list: if isAuthenticated();
    }
    match /tasks/{taskId} {
      allow read, write: if isAuthenticated();
    }

    // BreakdownReports Collection
    match /breakdown_reports {
      allow list: if isAuthenticated();
    }
    match /breakdown_reports/{breakdownReportId} {
      allow read, write: if isAuthenticated();
    }

    // CompletedSchedules Collection
    match /completed_schedules {
      allow list: if isAuthenticated();
    }
    match /completed_schedules/{scheduleId} {
      allow read, write: if isAuthenticated();
    }

    // Users Collection
    match /users {
      allow list: if isAuthenticated();
    }
    match /users/{userId} {
      allow read, write: if isAuthenticated();
    }

    // DailyDiaries Collection
    match /daily_diaries {
      allow list: if isAuthenticated();
    }
    match /daily_diaries/{diaryId} {
      allow read, write: if isAuthenticated();
    }
    
    // Timesheets Collection (user-specific access)
    match /timesheets/{timesheetId} {
      allow read, write: if isAuthenticated() && request.auth.uid == timesheetId.split('_')[0];
    }
    match /timesheets {
        // Users can only list their own timesheets, which isn't possible with a simple collection query.
        // This rule is restrictive by default. The application should query based on user ID.
        allow list: if false; 
    }
  }
}
